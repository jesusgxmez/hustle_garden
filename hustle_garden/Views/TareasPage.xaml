<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:HuertoApp.ViewModels"
             xmlns:converters="clr-namespace:HuertoApp.Converters"
             x:Class="hustle_garden.Views.TareasPage"
             Title="Tareas">

	<ContentPage.Resources>
		<ResourceDictionary>
			<converters:StringNotNullOrEmptyConverter x:Key="StringNotNullOrEmptyConverter"/>
			<converters:IsNotNullConverter x:Key="IsNotNullConverter"/>
		</ResourceDictionary>
	</ContentPage.Resources>

	<Grid>
		<BoxView>
			<BoxView.Background>
				<LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
					<GradientStop Color="#E8F5E9" Offset="0.0"/>
					<GradientStop Color="#F1F8E9" Offset="1.0"/>
				</LinearGradientBrush>
			</BoxView.Background>
		</BoxView>

		<Grid ColumnDefinitions="*,*" Padding="15" ColumnSpacing="15">
			<Border Grid.Column="0" StrokeShape="RoundRectangle 20" StrokeThickness="0" BackgroundColor="White">
				<Grid RowDefinitions="Auto, *">
					<Border Grid.Row="0" BackgroundColor="#FFF3E0" Padding="20,15">
						<Label Text="ğŸ“‹ Tareas Pendientes" FontSize="20" FontAttributes="Bold" TextColor="#F57C00"/>
					</Border>
					<ScrollView Grid.Row="1">
						<CollectionView ItemsSource="{Binding TareasPendientes}" Margin="15">
							<CollectionView.EmptyView>
								<Label Text="No hay tareas pendientes" TextColor="Black" FontSize="16" HorizontalOptions="Center" Margin="0,20"/>
							</CollectionView.EmptyView>
							<CollectionView.ItemTemplate>
								<DataTemplate>
									<Border BackgroundColor="#FFFDE7" Margin="0,5" Padding="10" StrokeShape="RoundRectangle 10">
										<Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
											<CheckBox Grid.Column="0" IsChecked="{Binding Completada, Mode=OneWay}" CheckedChanged="OnCheckboxChanged" Color="#4CAF50"/>
											<VerticalStackLayout Grid.Column="1">
												<Label Text="{Binding Titulo}" FontAttributes="Bold" FontSize="16" TextColor="Black"/>
												<Label Text="{Binding Descripcion}" FontSize="13" TextColor="#333" IsVisible="{Binding Descripcion, Converter={StaticResource StringNotNullOrEmptyConverter}}"/>
											</VerticalStackLayout>
										</Grid>
									</Border>
								</DataTemplate>
							</CollectionView.ItemTemplate>
						</CollectionView>
					</ScrollView>
				</Grid>
			</Border>

			<Border Grid.Column="1" StrokeShape="RoundRectangle 20" StrokeThickness="0" BackgroundColor="White">
				<Grid RowDefinitions="Auto, *">
					<Border Grid.Row="0" BackgroundColor="#E8F5E9" Padding="20,15">
						<Label Text="âœ… Completadas" FontSize="20" FontAttributes="Bold" TextColor="#2E7D32"/>
					</Border>
					<ScrollView Grid.Row="1">
						<CollectionView ItemsSource="{Binding TareasCompletadas}" Margin="15">
							<CollectionView.EmptyView>
								<Label Text="AÃºn no hay tareas completadas" TextColor="Black" FontSize="16" HorizontalOptions="Center" Margin="0,20"/>
							</CollectionView.EmptyView>
							<CollectionView.ItemTemplate>
								<DataTemplate>
									<Border BackgroundColor="White" Margin="0,5" Padding="10" StrokeShape="RoundRectangle 10" Stroke="#C8E6C9">
										<VerticalStackLayout>
											<Label Text="{Binding Titulo}" FontAttributes="Bold" FontSize="15" TextDecorations="Strikethrough" TextColor="#666"/>
											<Label Text="{Binding Descripcion}" FontSize="12" TextDecorations="Strikethrough" TextColor="#999" IsVisible="{Binding Descripcion, Converter={StaticResource StringNotNullOrEmptyConverter}}"/>
										</VerticalStackLayout>
									</Border>
								</DataTemplate>
							</CollectionView.ItemTemplate>
						</CollectionView>
					</ScrollView>
				</Grid>
			</Border>
		</Grid>

		<Button Text="+" FontSize="30" WidthRequest="60" HeightRequest="60" CornerRadius="30" BackgroundColor="#4CAF50" TextColor="White" HorizontalOptions="End" VerticalOptions="End" Margin="20" Command="{Binding MostrarPopupNuevaTareaCommand}"/>

		<Border IsVisible="{Binding MostrarPopupNuevaTarea}" BackgroundColor="#80000000">
			<Border BackgroundColor="White" Padding="20" WidthRequest="400" HeightRequest="500" HorizontalOptions="Center" VerticalOptions="Center" StrokeShape="RoundRectangle 20">
				<VerticalStackLayout Spacing="15">
					<Label Text="âœ¨ Nueva Tarea" FontSize="24" FontAttributes="Bold" TextColor="#1B5E20"/>
					<Entry Placeholder="TÃ­tulo" Text="{Binding TituloNuevaTarea}" TextColor="Black" PlaceholderColor="#666"/>
					<Editor Placeholder="DescripciÃ³n" Text="{Binding DescripcionNuevaTarea}" HeightRequest="80" TextColor="Black" PlaceholderColor="#666"/>
					<Picker Title="Planta" ItemsSource="{Binding Plantas}" ItemDisplayBinding="{Binding Nombre}" SelectedItem="{Binding PlantaSeleccionada}" TextColor="Black" TitleColor="#666"/>
					<Picker Title="Prioridad" SelectedItem="{Binding PrioridadSeleccionada}" TextColor="Black" TitleColor="#666">
						<Picker.ItemsSource>
							<x:Array Type="{x:Type x:String}">
								<x:String>Baja</x:String>
								<x:String>Media</x:String>
								<x:String>Alta</x:String>
								<x:String>Urgente</x:String>
							</x:Array>
						</Picker.ItemsSource>
					</Picker>
					<Grid ColumnDefinitions="*,*" ColumnSpacing="10">
						<Button Grid.Column="0" Text="Cancelar" Command="{Binding CerrarPopupNuevaTareaCommand}" TextColor="Black"/>
						<Button Grid.Column="1" Text="Agregar" BackgroundColor="#4CAF50" TextColor="White" Command="{Binding AgregarTareaCommand}"/>
					</Grid>
				</VerticalStackLayout>
			</Border>
		</Border>
	</Grid>
</ContentPage>