<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:HuertoApp.ViewModels"
             xmlns:converters="clr-namespace:HuertoApp.Converters"
             x:Class="hustle_garden.Views.TareasPage"
             Title="Tareas">

	<ContentPage.Resources>
		<ResourceDictionary>
			<converters:StringNotNullOrEmptyConverter x:Key="StringNotNullOrEmptyConverter"/>
			<converters:IsNotNullConverter x:Key="IsNotNullConverter"/>
		</ResourceDictionary>
	</ContentPage.Resources>

	<Grid>
		<BoxView>
			<BoxView.Background>
				<LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
					<GradientStop Color="#C8E6C9" Offset="0.0"/>
					<GradientStop Color="#DCEDC8" Offset="1.0"/>
				</LinearGradientBrush>
			</BoxView.Background>
		</BoxView>

		<Grid ColumnDefinitions="*,*" Padding="15" ColumnSpacing="15">
			<Border Grid.Column="0" StrokeShape="RoundRectangle 20" StrokeThickness="0" BackgroundColor="White">
				<Grid RowDefinitions="Auto, *">
					<Border Grid.Row="0" BackgroundColor="#FFF3E0" Padding="20,15">
						<Label Text="ğŸ“‹ Tareas Pendientes" FontSize="20" FontAttributes="Bold" TextColor="#F57C00"/>
					</Border>
					<ScrollView Grid.Row="1">
						<CollectionView ItemsSource="{Binding TareasPendientes}" Margin="15">
							<CollectionView.EmptyView>
								<VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Padding="20" Spacing="10">
									<Label Text="ğŸ“‹" FontSize="48" HorizontalOptions="Center"/>
									<Label Text="No hay tareas pendientes" TextColor="#1B5E20" FontSize="18" FontAttributes="Bold" HorizontalOptions="Center"/>
									<Label Text="Â¡Genial! Todo al dÃ­a" TextColor="#424242" FontSize="14" HorizontalOptions="Center"/>
								</VerticalStackLayout>
							</CollectionView.EmptyView>
							<CollectionView.ItemTemplate>
								<DataTemplate>
									<Border BackgroundColor="#FFFDE7" Margin="0,5" Padding="12" StrokeShape="RoundRectangle 10">
										<Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
											<CheckBox Grid.Column="0" IsChecked="{Binding Completada, Mode=OneWay}" CheckedChanged="OnCheckboxChanged" Color="#4CAF50" VerticalOptions="Start" Margin="0,5,0,0"/>
											<VerticalStackLayout Grid.Column="1" Spacing="6">
												<Label Text="{Binding Titulo}" FontAttributes="Bold" FontSize="16" TextColor="Black"/>
												<Label Text="{Binding Descripcion}" FontSize="13" TextColor="#333" IsVisible="{Binding Descripcion, Converter={StaticResource StringNotNullOrEmptyConverter}}"/>
												
												<!-- Badges de Prioridad y Planta -->
												<HorizontalStackLayout Spacing="8" Margin="0,4,0,0">
													<!-- Badge de Prioridad -->
													<Border Padding="8,4" StrokeShape="RoundRectangle 8" StrokeThickness="0">
														<Border.Triggers>
															<DataTrigger TargetType="Border" Binding="{Binding Prioridad}" Value="Urgente">
																<Setter Property="BackgroundColor" Value="#D32F2F"/>
															</DataTrigger>
															<DataTrigger TargetType="Border" Binding="{Binding Prioridad}" Value="Alta">
																<Setter Property="BackgroundColor" Value="#F57C00"/>
															</DataTrigger>
															<DataTrigger TargetType="Border" Binding="{Binding Prioridad}" Value="Media">
																<Setter Property="BackgroundColor" Value="#FBC02D"/>
															</DataTrigger>
															<DataTrigger TargetType="Border" Binding="{Binding Prioridad}" Value="Baja">
																<Setter Property="BackgroundColor" Value="#388E3C"/>
															</DataTrigger>
														</Border.Triggers>
														<Label FontSize="11" FontAttributes="Bold" TextColor="White">
															<Label.Triggers>
																<DataTrigger TargetType="Label" Binding="{Binding Prioridad}" Value="Urgente">
																	<Setter Property="Text" Value="ğŸ”´ URGENTE"/>
																</DataTrigger>
																<DataTrigger TargetType="Label" Binding="{Binding Prioridad}" Value="Alta">
																	<Setter Property="Text" Value="ğŸŸ  ALTA"/>
																</DataTrigger>
																<DataTrigger TargetType="Label" Binding="{Binding Prioridad}" Value="Media">
																	<Setter Property="Text" Value="ğŸŸ¡ MEDIA"/>
																</DataTrigger>
																<DataTrigger TargetType="Label" Binding="{Binding Prioridad}" Value="Baja">
																	<Setter Property="Text" Value="ğŸŸ¢ BAJA"/>
																</DataTrigger>
															</Label.Triggers>
														</Label>
													</Border>
													
													<!-- Badge de Planta -->
													<Border Padding="8,4" StrokeShape="RoundRectangle 8" BackgroundColor="#4CAF50" StrokeThickness="0" IsVisible="{Binding Planta, Converter={StaticResource IsNotNullConverter}}">
														<Label Text="{Binding Planta.Nombre, StringFormat='ğŸŒ± {0}'}" FontSize="11" FontAttributes="Bold" TextColor="White"/>
													</Border>
												</HorizontalStackLayout>
											</VerticalStackLayout>
										</Grid>
									</Border>
								</DataTemplate>
							</CollectionView.ItemTemplate>
						</CollectionView>
					</ScrollView>
				</Grid>
			</Border>

			<Border Grid.Column="1" StrokeShape="RoundRectangle 20" StrokeThickness="0" BackgroundColor="White">
				<Grid RowDefinitions="Auto, *">
					<Border Grid.Row="0" BackgroundColor="#E8F5E9" Padding="20,15">
						<Label Text="âœ… Completadas" FontSize="20" FontAttributes="Bold" TextColor="#2E7D32"/>
					</Border>
					<ScrollView Grid.Row="1">
						<CollectionView ItemsSource="{Binding TareasCompletadas}" Margin="15">
							<CollectionView.EmptyView>
								<VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Padding="20" Spacing="10">
									<Label Text="âœ…" FontSize="48" HorizontalOptions="Center"/>
									<Label Text="AÃºn no hay tareas completadas" TextColor="#1B5E20" FontSize="18" FontAttributes="Bold" HorizontalOptions="Center"/>
									<Label Text="Completa una tarea para verla aquÃ­" TextColor="#424242" FontSize="14" HorizontalOptions="Center"/>
								</VerticalStackLayout>
							</CollectionView.EmptyView>
							<CollectionView.ItemTemplate>
								<DataTemplate>
									<Border BackgroundColor="White" Margin="0,5" Padding="12" StrokeShape="RoundRectangle 10" Stroke="#C8E6C9">
										<VerticalStackLayout Spacing="6">
											<Label Text="{Binding Titulo}" FontAttributes="Bold" FontSize="15" TextDecorations="Strikethrough" TextColor="#666"/>
											<Label Text="{Binding Descripcion}" FontSize="12" TextDecorations="Strikethrough" TextColor="#999" IsVisible="{Binding Descripcion, Converter={StaticResource StringNotNullOrEmptyConverter}}"/>
											
											<!-- Badges de Prioridad y Planta -->
											<HorizontalStackLayout Spacing="8" Margin="0,4,0,0">
												<!-- Badge de Prioridad -->
												<Border Padding="8,4" StrokeShape="RoundRectangle 8" StrokeThickness="0" Opacity="0.7">
													<Border.Triggers>
														<DataTrigger TargetType="Border" Binding="{Binding Prioridad}" Value="Urgente">
															<Setter Property="BackgroundColor" Value="#D32F2F"/>
														</DataTrigger>
														<DataTrigger TargetType="Border" Binding="{Binding Prioridad}" Value="Alta">
															<Setter Property="BackgroundColor" Value="#F57C00"/>
														</DataTrigger>
														<DataTrigger TargetType="Border" Binding="{Binding Prioridad}" Value="Media">
															<Setter Property="BackgroundColor" Value="#FBC02D"/>
														</DataTrigger>
														<DataTrigger TargetType="Border" Binding="{Binding Prioridad}" Value="Baja">
															<Setter Property="BackgroundColor" Value="#388E3C"/>
														</DataTrigger>
													</Border.Triggers>
													<Label FontSize="11" FontAttributes="Bold" TextColor="White">
														<Label.Triggers>
															<DataTrigger TargetType="Label" Binding="{Binding Prioridad}" Value="Urgente">
																<Setter Property="Text" Value="ğŸ”´ URGENTE"/>
															</DataTrigger>
															<DataTrigger TargetType="Label" Binding="{Binding Prioridad}" Value="Alta">
																<Setter Property="Text" Value="ğŸŸ  ALTA"/>
															</DataTrigger>
															<DataTrigger TargetType="Label" Binding="{Binding Prioridad}" Value="Media">
																<Setter Property="Text" Value="ğŸŸ¡ MEDIA"/>
															</DataTrigger>
															<DataTrigger TargetType="Label" Binding="{Binding Prioridad}" Value="Baja">
																<Setter Property="Text" Value="ğŸŸ¢ BAJA"/>
															</DataTrigger>
														</Label.Triggers>
													</Label>
												</Border>
												
												<!-- Badge de Planta -->
												<Border Padding="8,4" StrokeShape="RoundRectangle 8" BackgroundColor="#4CAF50" StrokeThickness="0" Opacity="0.7" IsVisible="{Binding Planta, Converter={StaticResource IsNotNullConverter}}">
													<Label Text="{Binding Planta.Nombre, StringFormat='ğŸŒ± {0}'}" FontSize="11" FontAttributes="Bold" TextColor="White"/>
												</Border>
											</HorizontalStackLayout>
										</VerticalStackLayout>
									</Border>
								</DataTemplate>
							</CollectionView.ItemTemplate>
						</CollectionView>
					</ScrollView>
				</Grid>
			</Border>
		</Grid>

		<Button Text="+" FontSize="30" WidthRequest="60" HeightRequest="60" CornerRadius="30" BackgroundColor="#4CAF50" TextColor="White" HorizontalOptions="End" VerticalOptions="End" Margin="20" Command="{Binding MostrarPopupNuevaTareaCommand}"/>

		<Border IsVisible="{Binding MostrarPopupNuevaTarea}" BackgroundColor="#80000000">
			<Border BackgroundColor="White" Padding="20" WidthRequest="400" HeightRequest="500" HorizontalOptions="Center" VerticalOptions="Center" StrokeShape="RoundRectangle 20">
				<VerticalStackLayout Spacing="15">
					<Label Text="âœ¨ Nueva Tarea" FontSize="24" FontAttributes="Bold" TextColor="#1B5E20"/>
					<Entry Placeholder="TÃ­tulo" Text="{Binding TituloNuevaTarea}" TextColor="Black" PlaceholderColor="#666"/>
					<Editor Placeholder="DescripciÃ³n" Text="{Binding DescripcionNuevaTarea}" HeightRequest="80" TextColor="Black" PlaceholderColor="#666"/>
					<Picker Title="Planta" ItemsSource="{Binding Plantas}" ItemDisplayBinding="{Binding Nombre}" SelectedItem="{Binding PlantaSeleccionada}" TextColor="Black" TitleColor="#666"/>
					<Picker Title="Prioridad" SelectedItem="{Binding PrioridadSeleccionada}" TextColor="Black" TitleColor="#666">
						<Picker.ItemsSource>
							<x:Array Type="{x:Type x:String}">
								<x:String>Baja</x:String>
								<x:String>Media</x:String>
								<x:String>Alta</x:String>
								<x:String>Urgente</x:String>
							</x:Array>
						</Picker.ItemsSource>
					</Picker>
					<Grid ColumnDefinitions="*,*" ColumnSpacing="10">
						<Button Grid.Column="0" Text="Cancelar" Command="{Binding CerrarPopupNuevaTareaCommand}" TextColor="Black"/>
						<Button Grid.Column="1" Text="Agregar" BackgroundColor="#4CAF50" TextColor="White" Command="{Binding AgregarTareaCommand}"/>
					</Grid>
				</VerticalStackLayout>
			</Border>
		</Border>
	</Grid>
</ContentPage>